@echo off
setlocal enabledelayedexpansion

echo [INFO] Starting Admin Installation...
echo [INFO] Please make sure you right-clicked and selected 'Run as Administrator'.
pause

REM ID from manifest.xml
set "ADDIN_ID=b704c768-466d-4952-8700-123456789abc"
set "MANIFEST_FILENAME=manifest.xml"
set "MANIFEST_PATH=%~dp0%MANIFEST_FILENAME%"

if not exist "%MANIFEST_PATH%" (
    echo Error: %MANIFEST_FILENAME% not found.
    pause
    exit /b 1
)

echo [ATTEMPT] Trying SYSTEM WIDE registration (Right-click -> Run as Admin required)...

REM Registry Key for Outlook Developer Mode (HKLM)
set "REG_KEY=HKEY_LOCAL_MACHINE\Software\Microsoft\Office\16.0\WEF\Developer"

echo Registering to %REG_KEY%...
reg add "%REG_KEY%" /v "%ADDIN_ID%" /t REG_SZ /d "%MANIFEST_PATH%" /f

if %errorlevel% equ 0 (
    echo.
    echo [SUCCESS] Registered to HKLM!
    echo Please restart Outlook and check.
) else (
    echo.
    echo [FAIL] Access Denied.
    echo You MUST right-click this file and select 'Run as Administrator'.
)

pause
